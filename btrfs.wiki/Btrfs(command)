{{Outdated| Refer to [[Manpage/btrfs]].}}

'''btrfs''' is used to control the filesystem and the files and directories stored. It is the tool to create or destroy a snapshot or a subvolume for the filesystem, to defrag a file or a directory, flush the data to the disk, to resize the filesystem, to scan the device.

It is possible to abbreviate the commands unless the commands are ambiguous. For example: it is possible to run btrfs sub snaps instead of btrfs subvolume snapshot. But btrfs dev s is not allowed, because dev s may be interpreted both as device show and as device scan. In this case btrfs returns an error.

If a command is terminated by --help , the relevant help is showed. If the passed command matches more commands, the help of all the matched commands are showed. For example btrfs dev --help shows the help of all device* command.


=== Usage ===

 btrfs help
 Usage:
         btrfs subvolume snapshot &lt;source&gt; [&lt;dest&gt;/]&lt;name&gt;
                 Create a writable snapshot of the subvolume &lt;source&gt; with
                 the name &lt;name&gt; in the &lt;dest&gt; directory.
         btrfs subvolume delete &lt;subvolume&gt;
                 Delete the subvolume &lt;subvolume&gt;.
         btrfs subvolume create [&lt;dest&gt;/]&lt;name&gt;
                 Create a subvolume in &lt;dest&gt; (or the current directory if
                 not passed).
         btrfs subvolume list &lt;path&gt;
                 List the snapshot/subvolume of a filesystem.
         btrfs subvolume find-new &lt;path&gt; &lt;last_gen&gt;
                 List the recently modified files in a filesystem.
         btrfs filesystem defragment [-vcf] [-s start] [-l len] [-t size] &lt;file&gt;|&lt;dir&gt; [&lt;file&gt;|&lt;dir&gt;...]
                 Defragment a file or a directory.
         btrfs subvolume set-default &lt;id&gt; &lt;path&gt;
                 Set the subvolume of the filesystem &lt;path&gt; which will be mounted
                 as default.
         btrfs filesystem sync &lt;path&gt;
                 Force a sync on the filesystem &lt;path&gt;.
         btrfs filesystem resize [&lt;devid&gt;:][+/-]&lt;newsize&gt;[gkm]|max &lt;filesystem&gt;
                 Resize the file system. If 'max' is passed, the filesystem
                 will occupe all available space on the device. &lt;devid&gt; refers to
                 the device which was grow or shrink.
         btrfs filesystem show [&lt;uuid&gt;|&lt;label&gt;]
                 Show the info of a btrfs filesystem. If no &lt;uuid&gt; or &lt;label&gt;
                 is passed, info of all the btrfs filesystem are shown.
         btrfs filesystem df &lt;path&gt;
                 Show space usage information for a mount point.
         btrfs filesystem balance &lt;path&gt;
                 Balance the chunks across the device.
         btrfs device scan [&lt;device&gt; [&lt;device&gt;..]
                 Scan all device for or the passed device for a btrfs
                 filesystem.
         btrfs device add &lt;dev&gt; [&lt;dev&gt;..] &lt;path&gt;
                 Add a device to a filesystem.
         btrfs device delete &lt;dev&gt; [&lt;dev&gt;..] &lt;path&gt;
                 Remove a device from a filesystem.
 
         btrfs help|--help|-h
                 Show the help.

=== COMMANDS ===

{{note|most btrfs subcommands require the filesystem to be mounted, and take a path to the mounted filesystem, rather than the name of any particular device.}}

 subvolume snapshot &lt;source&gt; [&lt;dest&gt;/]&lt;name&gt;

Create a writable snapshot of the subvolume &lt;source&gt; with the name &lt;name&gt; in the &lt;dest&gt; directory. If &lt;source&gt; is not a sub- volume, btrfs returns an error.

 subvolume delete &lt;subvolume&gt;

Delete the subvolume &lt;subvolume&gt;. If &lt;subvolume&gt; is not a sub- volume, btrfs returns an error.

 subvolume create [&lt;dest&gt;/]&lt;name&gt;

Create a subvolume in &lt;dest&gt; (or in the current directory if &lt;dest&gt; is omitted).

 subvolume list &lt;path&gt;

List the subvolumes present in the filesystem &lt;path&gt;. For every subvolume is showed the subvolume ID (second column), the ID of the top level subvolume (fifth column), and the path (seventh column) relative to the top level subvolume. These &lt;ID&gt; may be used by the subvolume set-default command, or at mount time via the subvol= option.

 subvolume set-default &lt;id&gt; &lt;path&gt;

Set the subvolume of the filesystem &lt;path&gt; which is mounted as default. The subvolume is identified by &lt;id&gt;, which is returned by the subvolume list command.

 filesystem defragment &lt;file&gt;|&lt;dir&gt; [&lt;file&gt;|&lt;dir&gt;...]

Defragment files and/or directories.

 filesystem defragment [-vcf] [-s start] [-l len] [-t size] &lt;file&gt;|&lt;dir&gt; [&lt;file&gt;|&lt;dir&gt;...]

Defragment file data or directory metadata.

-v         be verbose

-c         compress the file while defragmenting

-f         flush data to disk immediately after defragmenting

-s start   defragment only from byte onward

-l len     defragment only up to len bytes

-t size    minimal size of file to be considered for defragmenting

 filesystem sync &lt;path&gt;

Force a sync for the filesystem identified by &lt;path&gt;.

 filesystem resize [&lt;devid&gt;:][+/-]&lt;size&gt;[gkm]|max &lt;path&gt;

Resize a filesystem identified by &lt;path&gt;. The &lt;size&gt; parameter specifies the new size of the filesystem. If the prefix + or - is present the size is increased or decreased by the quantity &lt;size&gt;. If no units are specified, the unit of the &lt;size&gt; parameter defaults to bytes. Optionally, the size parameter may be suffixed by one of the following the units designators: 'K', 'M', or 'G', kilobytes, megabytes, or gigabytes, respectively.

If 'max' is passed, the filesystem will occupy all available space on the volume(s).

The resize command does not manipulate the size of underlying partition. If you wish to enlarge/reduce a filesystem, you must make sure you can expand the partition before enlarging the filesystem and shrink the partition after reducing the size of the filesystem.

&lt;devid&gt; is the id of the device which was grow or shrink, as show by the command '''btrfs filesystem show'''. If nothing is passed, the device devid=1 is used.

 filesystem show [&lt;uuid&gt;|&lt;label&gt;]

Show the btrfs filesystem with some additional info. If no UUID or label is passed, btrfs show info of all the btrfs filesystem.

 filesystem balance &lt;path&gt;

Balance the chunks of the filesystem identified by &lt;path&gt; across the devices.

 subvolume find-new &lt;subvolume&gt; &lt;last_gen&gt;

List the recently modified files in a subvolume, after &lt;last_gen&gt; ID.

 device add &lt;dev&gt; [&lt;dev&gt;..] &lt;path&gt;

Add device(s) to the filesystem identified by &lt;path&gt;.

 device delete &lt;dev&gt; [&lt;dev&gt;..] &lt;path&gt;

Remove device(s) from a filesystem identified by &lt;path&gt;.

=== EXIT STATUS ===

btrfs returns a zero exist status if it succeeds. Non zero is returned in case of failure.

=== AVAILABILITY ===

btrfs is part of btrfs-progs. Btrfs filesystem is currently under heavy development, and not suitable for any uses other than benchmarking and review. Please refer to the btrfs wiki http://btrfs.wiki.kernel.org for further details.

=== Note about the snapshot ===

It is possible to snapshot only the root volume or a subvolume. It is not possible to snapshot a directory.

A snapshot is not recursive. If a [sub]volume is snapshotted, the snapshot will not contain the enclosed subvolumes.

=== EXAMPLES ===

Suppose your BTRFS filesystem mountpoint is /mnt:

create a subvolume under /mnt/test. The new subvolume will be called NewSubVol

 btrfs subvolume create /mnt/test/NewSubVol

Create a snapshot of the subvolume NewSubVol.

 btrfs subvolume snapshot /mnt/test/NewSubVol /mnt/test/NewSnapShot

Delete a snapshot and a subvolume

 btrfs subvolume delete /mnt/test/NewSnapShot
 btrfs subvolume delete /mnt/test/NewSubVol

Add 2GB to the FS

 btrfs filesystem resize +2g /mnt

Shrink the FS by 4GB

 btrfs filesystem resize -4g /mnt

Explicitly set the FS size

 btrfs filesystem resize 20g /mnt

Use 'max' to grow the FS to the limit of the device

 btrfs filesystem resize max /mnt


[[Category:Tools]]
[[Category:Deprecated]]